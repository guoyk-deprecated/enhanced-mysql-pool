// Generated by CoffeeScript 1.6.3
(function() {
  var belog, emysql, endder;

  emysql = require('../index');

  emysql.init(__dirname + '/config.json');

  console.log('\n========== Pool will be killed after 5 minutes ===========\n');

  console.log('\n========== Every 3 sec one conn will be killed ==========\n');

  endder = setInterval(function() {
    return emysql.conn.end();
  }, 3000);

  belog = function(cb) {
    return function(err, rows) {
      if (err != null) {
        conosle.log("Error Occured: " + (JSON.stringify(err)));
      }
      console.log("Data Retrived: " + (JSON.stringify(rows)));
      if (typeof cb === 'function') {
        return cb();
      }
    };
  };

  emysql.conn.query('CREATE TABLE test (id INT NOT NULL AUTO_INCREMENT,data TEXT NOT NULL,PRIMARY KEY (id))', belog(function() {
    var i, _i;
    emysql.conn.query('SHOW DATABASES;', belog());
    console.log('\n========== Create 100 rows ==========\n========== And Log them out in 15 secs ==========');
    for (i = _i = 1; _i <= 100; i = ++_i) {
      emysql.conn.query('INSERT INTO test SET data = ?;', ['test_data,lalala'], belog());
    }
    return setTimeout(function() {
      return emysql.conn.query('SELECT * FROM test LIMIT 20;', belog(function() {
        var _j, _results;
        clearInterval(endder);
        console.log('========== Kill them all ==========');
        _results = [];
        for (i = _j = 1; _j < 50; i = ++_j) {
          try {
            _results.push(emysql.conn.end());
          } catch (_error) {}
        }
        return _results;
      }));
    }, 15000);
  }));

  setTimeout(function() {
    return process.exit(0);
  }, 300000);

}).call(this);
